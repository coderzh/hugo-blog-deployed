<!DOCTYPE html>
<html class="no-js">
<head>
  <base href="https://blog.coderzh.com/">
  <script>
    document._writeOriginal = document.write;
    document.write = function(str) {
        if (str.indexOf('livereload.js') > -1) {
            document._writeOriginal(str);
        } else {
            document._writeOriginal('<!-- Be Hijack!! -->');
        }
    }
  </script>
  <title>C#程序实现动态调用DLL的研究(转载) - CoderZh Blog</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="description" content="C#程序实现动态调用DLL****的研究 摘要：在《csdn开发高手》2004年第03期中的《化功大法——将DLL嵌入EXE》一文，介绍了如何">
<meta name="author" content="coderzh">
<meta name="publisher" content="coderzh">
<meta name="generator" content="http://gohugo.io/"/>

<meta itemprop="name" content="C#程序实现动态调用DLL的研究(转载) - CoderZh Blog">
<meta itemprop="description" content="C#程序实现动态调用DLL****的研究 摘要：在《csdn开发高手》2004年第03期中的《化功大法——将DLL嵌入EXE》一文，介绍了如何">
<meta itemprop="image" content="https://blog.coderzh.com/public/coderzh.jpg">

<meta property="og:title" content="C#程序实现动态调用DLL的研究(转载) - CoderZh Blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.coderzh.com/2007/12/27/1016924/" />
<meta property="og:image" content="https://blog.coderzh.com/public/coderzh.jpg" />
<meta property="og:description" content="C#程序实现动态调用DLL****的研究 摘要：在《csdn开发高手》2004年第03期中的《化功大法——将DLL嵌入EXE》一文，介绍了如何">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@coderzh">
<meta name="twitter:title" content="C#程序实现动态调用DLL的研究(转载) - CoderZh Blog">
<meta name="twitter:description" content="C#程序实现动态调用DLL****的研究 摘要：在《csdn开发高手》2004年第03期中的《化功大法——将DLL嵌入EXE》一文，介绍了如何">
<meta name="twitter:creator" content="@coderzh">
<meta name="twitter:image" content="https://blog.coderzh.com/public/coderzh.jpg">

  <script>document.documentElement.className = document.documentElement.className.replace("no-js", "js");</script>
  <link rel="canonical" href="https://blog.coderzh.com/2007/12/27/1016924/">
  <link rel='shortlink' href="https://blog.coderzh.com/2007/12/27/1016924/"/>
  <link rel="shortcut icon" href="https://blog.coderzh.com/public/favicon.ico"/>
  
<link rel="stylesheet" id="human-style-css" href="https://blog.coderzh.com/wp-content/themes/hueman/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="human-style-css2" href="https://blog.coderzh.com/wp-content/themes/hueman-child/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="human-style-css3" href="https://blog.coderzh.com/wp-content/themes/hueman-child/user.css" type="text/css" media="all"/>
<link rel="stylesheet" id="responsive-css" href="https://blog.coderzh.com/wp-content/themes/hueman/responsive.css" type="text/css" media="all"/>
<link rel="stylesheet" id="font-awesome-css" href="https://blog.coderzh.com/wp-content/themes/hueman/fonts/font-awesome.min.css" type="text/css" media="all"/>
<link rel="stylesheet" href="https://blog.coderzh.com/public/highlight/styles/github.css">
<script src="https://blog.coderzh.com/public/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript" async defer src="assets/js/myblog.js"></script>
</head>

<body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome">
<div id="wrapper">
  <header id="header">

  <nav class="nav-container group" id="nav-topbar">
    <div class="nav-toggle"><i class="fa fa-bars"></i></div>
    <div class="nav-text"></div>
    <div class="nav-wrap container">
      <a rel="nofollow" href="https://blog.coderzh.com/" class="nav-cs-icon">
        <img width="40" height="40" src="https://blog.coderzh.com/public/coderzh.jpg" alt="coderzh" title="Home">
      </a>
      <ul id="menu-default-menu" class="nav container-inner group">
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/">首页</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F/">思考感悟</a>
        </li>
        
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/post/">归档</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="https://blog.coderzh.com/about/">关于我</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          
        </li>
        <li class="menu-item menu-item-type-post_type menu-item-text">
        做个独立思考的程序员
        </li>
      </ul>
    </div>
  </nav>
  

</header>



  <div class="container" id="page">
    <div class="container-inner">
      <div class="main">
        <div class="main-inner group">
          <section class="content">
            <div class="page-title pad group">
              <ul class="meta-single group">
                
                <li class="category">
                  <a href="https://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" rel="category tag">技术文章</a>
                </li>
                
              </ul>
            </div>

            <div class="pad group">

              <article
                  class="post type-post status-publish format-standard has-post-thumbnail hentry category-australien tag-bondi-beach tag-city2surf tag-sydney">
                <div class="post-inner group">

                  <h1 class="post-title">C#程序实现动态调用DLL的研究(转载)</h1>

                  <p class="post-byline">
                    by  · 2007年12月27日 · 9771 Words ·
                    ~20min reading time |
                    <a href="https://github.com/coderzh/coderzh-hugo-blog/blob/master/content/post/cnblogs/2007-12-27-1016924.md"
                       target="_blank">Improve on <i class="fa fa-github"></i></a>
                  </p>

                  <div class="clear"></div>

                  <div class="entry">
                    <div class="entry-inner">
                      
                      <!-- raw HTML omitted -->
<p><strong><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->程序实现动态调用<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->****<!-- raw HTML omitted -->的研究<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->摘<!-- raw HTML omitted --> <!-- raw HTML omitted -->要：<!-- raw HTML omitted --><!-- raw HTML omitted -->在《<!-- raw HTML omitted --><!-- raw HTML omitted -->csdn<!-- raw HTML omitted --><!-- raw HTML omitted -->开发高手》<!-- raw HTML omitted --><!-- raw HTML omitted -->2004<!-- raw HTML omitted --><!-- raw HTML omitted -->年第<!-- raw HTML omitted --><!-- raw HTML omitted -->03<!-- raw HTML omitted --><!-- raw HTML omitted -->期中的《化功大法——将<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->嵌入<!-- raw HTML omitted --><!-- raw HTML omitted -->EXE<!-- raw HTML omitted --><!-- raw HTML omitted -->》一文，介绍了如何把一个动态链接库作为一个资源嵌入到可执行文件，在可执行文件运行时，自动从资源中释放出来，通过静态加载延迟实现ＤＬＬ函数的动态加载，程序退出后实现临时文件的自动删除，从而为解决“<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL Hell<!-- raw HTML omitted --><!-- raw HTML omitted -->”提供了一种解决方案。这是一个很好的设计思想，而且该作者也用<!-- raw HTML omitted --><!-- raw HTML omitted -->C++<!-- raw HTML omitted --><!-- raw HTML omitted -->实现了，在<!-- raw HTML omitted --><!-- raw HTML omitted -->Internet<!-- raw HTML omitted --><!-- raw HTML omitted -->上也有相似的<!-- raw HTML omitted --><!-- raw HTML omitted -->VB<!-- raw HTML omitted --><!-- raw HTML omitted -->程序，但在某一技术论坛上提起这种设计方法时，有网友提出：“这种方法好是好，但就是启动速度太慢”。这是因为程序启动时实现<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->释放，然后再加载释放出来的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，这个过程会耗费一定的时间。鉴于此问题，经过思索，提出另一个设计方案：<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->作为资源文件嵌入程序，但不需进行<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->释放及其重新加载。本文就是对该设计方案的原理分析及使用<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->编程来实现该设计方案。<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->关键词：<!-- raw HTML omitted --><!-- raw HTML omitted -->动态调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，嵌入<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->正<!-- raw HTML omitted --> <!-- raw HTML omitted -->文：<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->一、<!-- raw HTML omitted -->      <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->与应用程序<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->动态链接库（也称为<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，即为“<!-- raw HTML omitted --><!-- raw HTML omitted -->Dynamic Link Library<!-- raw HTML omitted --><!-- raw HTML omitted -->”的缩写）是<!-- raw HTML omitted --><!-- raw HTML omitted -->Microsoft Windows<!-- raw HTML omitted --><!-- raw HTML omitted -->最重要的组成要素之一，打开<!-- raw HTML omitted --><!-- raw HTML omitted -->Windows<!-- raw HTML omitted --><!-- raw HTML omitted -->系统文件夹，你会发现文件夹中有很多<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件，<!-- raw HTML omitted --><!-- raw HTML omitted -->Windows<!-- raw HTML omitted --><!-- raw HTML omitted -->就是将一些主要的系统功能以<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->模块的形式实现。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->动态链接库是不能直接执行的，也不能接收消息，它只是一个独立的文件，其中包含能被程序或其它<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->调用来完成一定操作的函数<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->方法。注：<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->中一般称为“方法”<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted --><!-- raw HTML omitted -->，但这些函数不是执行程序本身的一部分，而是根据进程的需要按需载入，此时才能发挥作用。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->只有在应用程序需要时才被系统加载到进程的虚拟空间中，成为调用进程的一部分，此时该<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->也只能被该进程的线程访问，它的句柄可以被调用进程所使用，而调用进程的句柄也可以被该<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->所使用。在内存中，一个<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->只有一个实例，且它的编制与具体的编程语言和编译器都没有关系，所以可以通过<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->来实现混合语言编程。<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->函数中的代码所创建的任何对象（包括变量）都归调用它的线程或进程所有。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->下面列出了当程序使用<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->时提供的一些优点：<!-- raw HTML omitted --><!-- raw HTML omitted -->[1]<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->1)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->****<!-- raw HTML omitted -->使用较少的资源<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->当多个程序使用同一个函数库时，<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->可以减少在磁盘和物理内存中加载的代码的重复量。这不仅可以大大影响在前台运行的程序，而且可以大大影响其他在<!-- raw HTML omitted --><!-- raw HTML omitted --> Windows <!-- raw HTML omitted --><!-- raw HTML omitted -->操作系统上运行的程序。<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->2)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->****<!-- raw HTML omitted -->推广模块式体系结构<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->有助于促进模块式程序的开发。这可以帮助您开发要求提供多个语言版本的大型程序或要求具有模块式体系结构的程序。模块式程序的一个示例是具有多个可以在运行时动态加载的模块的计帐程序。<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->3)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted -->****<!-- raw HTML omitted -->简化部署和安装<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->当<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->中的函数需要更新或修复时，部署和安装<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->不要求重新建立程序与该<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->的链接。此外，如果多个程序使用同一个<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，那么多个程序都将从该更新或修复中获益。当您使用定期更新或修复的第三方<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->时，此问题可能会更频繁地出现。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->二、<!-- raw HTML omitted -->      <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->的调用<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->每种编程语言调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->的方法都不尽相同，在此只对用<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->的方法进行介绍。首先<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --><!-- raw HTML omitted -->您需要了解什么是托管<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --><!-- raw HTML omitted -->什么是非托管。一般可以认为：非托管代码主要是基于<!-- raw HTML omitted --><!-- raw HTML omitted -->win 32<!-- raw HTML omitted --><!-- raw HTML omitted -->平台开发的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，<!-- raw HTML omitted --><!-- raw HTML omitted -->activeX<!-- raw HTML omitted --><!-- raw HTML omitted -->的组件，托管代码是基于<!-- raw HTML omitted --><!-- raw HTML omitted -->.net<!-- raw HTML omitted --><!-- raw HTML omitted -->平台开发的。如果您想深入了解托管与非托管的关系与区别，及它们的运行机制，请您自行查找资料，本文件在此不作讨论。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->(一)<!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->调用<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->****<!-- raw HTML omitted -->中的非托管函数一般方法<!-- raw HTML omitted --></strong></p>
<p><strong><!-- raw HTML omitted -->首先<!-- raw HTML omitted --></strong><!-- raw HTML omitted -->，应该在<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->语言源程序中声明外部方法，其基本形式是：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[DLLImport(“DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件<!-- raw HTML omitted --><!-- raw HTML omitted -->”)]<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->修饰符<!-- raw HTML omitted --><!-- raw HTML omitted --> extern <!-- raw HTML omitted --><!-- raw HTML omitted -->返回变量类型<!-- raw HTML omitted --> <!-- raw HTML omitted -->方法名称<!-- raw HTML omitted --> <!-- raw HTML omitted -->（参数列表）<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->其中<!-- raw HTML omitted --></strong><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件：包含定义外部方法的库文件。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->修饰符：<!-- raw HTML omitted --> <!-- raw HTML omitted -->访问修饰符，除了<!-- raw HTML omitted --><!-- raw HTML omitted -->abstract<!-- raw HTML omitted --><!-- raw HTML omitted -->以外在声明方法时可以使用的修饰符。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->返回变量类型：在<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件中你需调用方法的返回变量类型。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->方法名称：在<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件中你需调用方法的名称。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->参数列表：在<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件中你需调用方法的列表。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->注意<!-- raw HTML omitted --></strong><!-- raw HTML omitted -->：需要在程序声明中使用<!-- raw HTML omitted --><!-- raw HTML omitted -->System.Runtime.InteropServices<!-- raw HTML omitted --><!-- raw HTML omitted -->命名空间。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->      DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->只能放置在方法声明上。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件必须位于程序当前目录或系统定义的查询路径中（即：系统环境变量中<!-- raw HTML omitted --><!-- raw HTML omitted -->Path<!-- raw HTML omitted --><!-- raw HTML omitted -->所设置的路径）。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->返回变量类型、方法名称、参数列表一定要与<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件中的定义相一致。<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->若要使用其它函数名，可以使用<!-- raw HTML omitted --><!-- raw HTML omitted -->EntryPoint<!-- raw HTML omitted --><!-- raw HTML omitted -->属性设置，如：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[DllImport(&ldquo;user32.dll&rdquo;, EntryPoint=&quot;MessageBoxA&rdquo;)]<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->static extern int MsgBox(int hWnd, string msg, string caption, int type);<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->其它可选的<!-- raw HTML omitted --><!-- raw HTML omitted --> DllImportAttribute <!-- raw HTML omitted --><!-- raw HTML omitted -->属性：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->CharSet <!-- raw HTML omitted --><!-- raw HTML omitted -->指示用在入口点中的字符集，如：<!-- raw HTML omitted --><!-- raw HTML omitted -->CharSet=CharSet.Ansi<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->SetLastError <!-- raw HTML omitted --><!-- raw HTML omitted -->指示方法是否保留<!-- raw HTML omitted --><!-- raw HTML omitted --> Win32&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->上一错误<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->，如：<!-- raw HTML omitted --><!-- raw HTML omitted -->SetLastError=true<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->ExactSpelling <!-- raw HTML omitted --><!-- raw HTML omitted -->指示<!-- raw HTML omitted --><!-- raw HTML omitted --> EntryPoint <!-- raw HTML omitted --><!-- raw HTML omitted -->是否必须与指示的入口点的拼写完全匹配，如：<!-- raw HTML omitted --><!-- raw HTML omitted -->ExactSpelling=false<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->PreserveSig<!-- raw HTML omitted --><!-- raw HTML omitted -->指示方法的签名应当被保留还是被转换，<!-- raw HTML omitted --> <!-- raw HTML omitted -->如：<!-- raw HTML omitted --><!-- raw HTML omitted -->PreserveSig=true<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->CallingConvention<!-- raw HTML omitted --><!-- raw HTML omitted -->指示入口点的调用约定，<!-- raw HTML omitted --> <!-- raw HTML omitted -->如：<!-- raw HTML omitted --><!-- raw HTML omitted -->CallingConvention=CallingConvention.Winapi<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->此外，关于“数据封送处理”及“封送数字和逻辑标量”请参阅其它一些文章<!-- raw HTML omitted --><!-- raw HTML omitted -->[2]<!-- raw HTML omitted --><!-- raw HTML omitted -->。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->C#<!-- raw HTML omitted -->****<!-- raw HTML omitted -->例子：<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->1.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><!-- raw HTML omitted -->VS.NET<!-- raw HTML omitted --><!-- raw HTML omitted -->，新建一个项目，项目名称为“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”，模板为“<!-- raw HTML omitted --><!-- raw HTML omitted -->Windows <!-- raw HTML omitted --><!-- raw HTML omitted -->应用程序”。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->2.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在“工具箱”的“<!-- raw HTML omitted --><!-- raw HTML omitted --> Windows <!-- raw HTML omitted --><!-- raw HTML omitted -->窗体”项中双击“<!-- raw HTML omitted --><!-- raw HTML omitted -->Button<!-- raw HTML omitted --><!-- raw HTML omitted -->”项，向“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”窗体中添加一个按钮。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->3.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->改变按钮的属性：<!-- raw HTML omitted --><!-- raw HTML omitted -->Name<!-- raw HTML omitted --><!-- raw HTML omitted -->为<!-- raw HTML omitted --> <!-- raw HTML omitted -->“B1”<!-- raw HTML omitted --><!-- raw HTML omitted -->，<!-- raw HTML omitted --><!-- raw HTML omitted -->Text<!-- raw HTML omitted --><!-- raw HTML omitted -->为<!-- raw HTML omitted --> <!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->用<!-- raw HTML omitted --><!-- raw HTML omitted -->DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->弹出提示框<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted -->，并将按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B1<!-- raw HTML omitted --><!-- raw HTML omitted -->调整到适当大小，移到适当位置。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->4.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在类视图中双击“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”，打开“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->”代码视图，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->namespace Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”上面输入“<!-- raw HTML omitted --><!-- raw HTML omitted -->using System.Runtime.InteropServices;<!-- raw HTML omitted --><!-- raw HTML omitted -->”，以导入该命名空间。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->5.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B1<!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B1_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法上面使用关键字<!-- raw HTML omitted --><!-- raw HTML omitted --> static <!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted --> extern <!-- raw HTML omitted --><!-- raw HTML omitted -->声明方法“<!-- raw HTML omitted --><!-- raw HTML omitted -->MsgBox<!-- raw HTML omitted --><!-- raw HTML omitted -->”，将<!-- raw HTML omitted --><!-- raw HTML omitted --> DllImport <!-- raw HTML omitted --><!-- raw HTML omitted -->属性附加到该方法，这里我们要使用的是“<!-- raw HTML omitted --><!-- raw HTML omitted -->user32<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->dll<!-- raw HTML omitted --><!-- raw HTML omitted -->”中的“<!-- raw HTML omitted --><!-- raw HTML omitted -->MessageBoxA<!-- raw HTML omitted --><!-- raw HTML omitted -->”函数，具体代码如下：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>[DllImport(&ldquo;user32.dll&rdquo;, EntryPoint=&quot;MessageBoxA&rdquo;)]</p>
<p>static extern int MsgBox(int hWnd, string msg, string caption, int type);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->然后在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B1_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码，以调用方法“<!-- raw HTML omitted --><!-- raw HTML omitted -->MsgBox<!-- raw HTML omitted --><!-- raw HTML omitted -->”：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>MsgBox(0,&rdquo; 这就是用 DllImport 调用 DLL 弹出的提示框哦！ &ldquo;,&rdquo; 挑战杯 &ldquo;,0x30);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->6.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->按“<!-- raw HTML omitted --><!-- raw HTML omitted -->F5<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->运行该程序，并点击按钮<!-- raw HTML omitted -->B1<!-- raw HTML omitted --><!-- raw HTML omitted -->，便弹出如下提示框：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p> </p>
<p><strong><!-- raw HTML omitted -->(二)<!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->动态装载、调用<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->****<!-- raw HTML omitted -->中的非托管函数<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->在上面已经说明了如何用<!-- raw HTML omitted --><!-- raw HTML omitted -->DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的非托管函数，但是这个是全局的函数，假若<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的非托管函数有一个静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->S<!-- raw HTML omitted --><!-- raw HTML omitted -->，每次调用这个函数的时候，静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->S<!-- raw HTML omitted --><!-- raw HTML omitted -->就自动加<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->。结果，当需要重新计数时，就不能得出想要的结果。下面将用例子说明：<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->1.<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->的创建<!-- raw HTML omitted --></strong></p>
<p><strong><!-- raw HTML omitted -->1)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><!-- raw HTML omitted -->Visual C++ 6.0<!-- raw HTML omitted --><!-- raw HTML omitted -->；<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->2)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->新建一<!-- raw HTML omitted --><!-- raw HTML omitted -->个“<!-- raw HTML omitted --><!-- raw HTML omitted -->Win32 Dynamic-Link Library<!-- raw HTML omitted --><!-- raw HTML omitted -->”工程，工程名称为“<!-- raw HTML omitted --><!-- raw HTML omitted -->Count<!-- raw HTML omitted --><!-- raw HTML omitted -->”；<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->3)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Dll kind<!-- raw HTML omitted --><!-- raw HTML omitted -->”选择界面中选择“<!-- raw HTML omitted --><!-- raw HTML omitted -->A simple dll project<!-- raw HTML omitted --><!-- raw HTML omitted -->”；<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->4)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->打开<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.cpp<!-- raw HTML omitted --><!-- raw HTML omitted -->，添加如下代码：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 导出函数，使用“ _stdcall ” 标准调用</p>
<p>extern &ldquo;C&rdquo; _declspec(dllexport)int _stdcall count(int init);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>int _stdcall count(int init)</p>
<p>{//count 函数，使用参数 init 初始化静态的整形变量 S ，并使 S 自加 1 后返回该值</p>
<p>static int S=init;</p>
<p>S++;</p>
<p>return S;</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><strong><!-- raw HTML omitted -->5)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->按“<!-- raw HTML omitted --><!-- raw HTML omitted -->F7<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->进行编译，得到<!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->（在工程目录下的<!-- raw HTML omitted --><!-- raw HTML omitted -->Debug<!-- raw HTML omitted --><!-- raw HTML omitted -->文件夹中）。<!-- raw HTML omitted --></p>
<p> </p>
<p><strong><!-- raw HTML omitted -->2.<!-- raw HTML omitted -->         <!-- raw HTML omitted --><!-- raw HTML omitted -->****<!-- raw HTML omitted -->用<!-- raw HTML omitted -->DllImport<!-- raw HTML omitted -->调用<!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->中的<!-- raw HTML omitted -->count<!-- raw HTML omitted -->函数<!-- raw HTML omitted --></strong></p>
<p><strong><!-- raw HTML omitted -->1)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->打开项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”，向“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->窗体中添加一个按钮。<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->2)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->改变按钮的属性：<!-- raw HTML omitted --><!-- raw HTML omitted -->Name<!-- raw HTML omitted --><!-- raw HTML omitted -->为<!-- raw HTML omitted --> <!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->B2<!-- raw HTML omitted --><!-- raw HTML omitted -->”，<!-- raw HTML omitted --><!-- raw HTML omitted -->Text<!-- raw HTML omitted --><!-- raw HTML omitted -->为<!-- raw HTML omitted --> <!-- raw HTML omitted -->“用<!-- raw HTML omitted --><!-- raw HTML omitted -->DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->函数”，并将按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B1<!-- raw HTML omitted --><!-- raw HTML omitted -->调整到适当大小，移到适当位置。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->3)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->打开“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->”代码视图，使用关键字<!-- raw HTML omitted --><!-- raw HTML omitted --> static <!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted --> extern <!-- raw HTML omitted --><!-- raw HTML omitted -->声明方法“<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->”，并使其具有来自<!-- raw HTML omitted --><!-- raw HTML omitted --> Count.dll <!-- raw HTML omitted --><!-- raw HTML omitted -->的导出函数<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->的实现，代码如下：<!-- raw HTML omitted --></p>
<p> </p>
<!-- raw HTML omitted -->
<p>[DllImport(&ldquo;Count.dll&rdquo;)]</p>
<p>static extern int count(int init);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><strong><!-- raw HTML omitted -->4)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B2<!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B2_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>MessageBox.Show(&rdquo; 用 DllImport 调用 DLL 中的 count 函数， \n 传入的实参为 0 ，得到的结果是： &ldquo;+count(0).ToString(),&rdquo; 挑战杯 &ldquo;);</p>
<p>MessageBox.Show(&rdquo; 用 DllImport 调用 DLL 中的 count 函数， \n 传入的实参为 10 ，得到的结果是： &ldquo;+count(10).ToString()+&rdquo;\n 结果可不是想要的 11 哦！！！ &ldquo;,&rdquo; 挑战杯 &ldquo;);</p>
<p>MessageBox.Show(&rdquo; 所得结果表明： \n 用 DllImport 调用 DLL 中的非托管 \n 函数是全局的、静态的函数！！！ &ldquo;,&rdquo; 挑战杯 &ldquo;);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><strong><!-- raw HTML omitted -->5)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted -->把<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->复制到项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”的<!-- raw HTML omitted --><!-- raw HTML omitted -->bin\Debug<!-- raw HTML omitted --><!-- raw HTML omitted -->文件夹中，按“<!-- raw HTML omitted --><!-- raw HTML omitted -->F5<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->运行该程序，并点击按钮<!-- raw HTML omitted -->B2<!-- raw HTML omitted --><!-- raw HTML omitted -->，便弹出如下三个提示框：<!-- raw HTML omitted --></p>
<p> </p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->第<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->个提示框显示的是调用“<!-- raw HTML omitted --><!-- raw HTML omitted -->count(0)<!-- raw HTML omitted --><!-- raw HTML omitted -->”的结果，第<!-- raw HTML omitted --><!-- raw HTML omitted -->2<!-- raw HTML omitted --><!-- raw HTML omitted -->个提示框显示的是调用“<!-- raw HTML omitted --><!-- raw HTML omitted -->count(10)<!-- raw HTML omitted --><!-- raw HTML omitted -->”的结果，由所得结果可以证明“用<!-- raw HTML omitted --><!-- raw HTML omitted -->DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的非托管函数是全局的、静态的函数”。所以，有时候并不能达到我们目的，因此我们需要使用下面所介绍的方法：<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->动态调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的函数。<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->    <!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->3.<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->C#<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->动态调用<!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->中的函数<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->因为<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->中使用<!-- raw HTML omitted --><!-- raw HTML omitted -->DllImport<!-- raw HTML omitted --><!-- raw HTML omitted -->是不能像动态<!-- raw HTML omitted --><!-- raw HTML omitted -->load/unload assembly<!-- raw HTML omitted --><!-- raw HTML omitted -->那样，所以只能借助<!-- raw HTML omitted --><!-- raw HTML omitted -->API<!-- raw HTML omitted --><!-- raw HTML omitted -->函数了。在<!-- raw HTML omitted --><!-- raw HTML omitted -->kernel32.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->中，与动态库调用有关的函数包括<!-- raw HTML omitted --><!-- raw HTML omitted -->[3]<!-- raw HTML omitted --><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->①<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->（或<!-- raw HTML omitted --><!-- raw HTML omitted -->MFC <!-- raw HTML omitted --><!-- raw HTML omitted -->的<!-- raw HTML omitted --><!-- raw HTML omitted -->AfxLoadLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->），装载动态库。<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->②<!-- raw HTML omitted --><!-- raw HTML omitted -->GetProcAddress<!-- raw HTML omitted --><!-- raw HTML omitted -->，获取要引入的函数，将符号名或标识号转换为<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->内部地址。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->③<!-- raw HTML omitted --><!-- raw HTML omitted -->FreeLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->（或<!-- raw HTML omitted --><!-- raw HTML omitted -->MFC<!-- raw HTML omitted --><!-- raw HTML omitted -->的<!-- raw HTML omitted --><!-- raw HTML omitted -->AfxFreeLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->），释放动态链接库。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->它们的原型分别是：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->HMODULE LoadLibrary(LPCTSTR lpFileName);<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->FARPROC GetProcAddress(HMODULE hModule, LPCWSTR lpProcName);<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->BOOL FreeLibrary(HMODULE hModule);<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted -->现在，我们可以用<!-- raw HTML omitted --><!-- raw HTML omitted -->IntPtr hModule=LoadLibrary(“Count.dll”);<!-- raw HTML omitted --><!-- raw HTML omitted -->来获得<!-- raw HTML omitted --><!-- raw HTML omitted -->Dll<!-- raw HTML omitted --><!-- raw HTML omitted -->的句柄<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --><!-- raw HTML omitted -->用<!-- raw HTML omitted --><!-- raw HTML omitted -->IntPtr farProc=GetProcAddress(hModule,”<!-- raw HTML omitted --><!-- raw HTML omitted -->_count@4<!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->);<!-- raw HTML omitted --><!-- raw HTML omitted -->来获得函数的入口地址。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->但是，知道函数的入口地址后，怎样调用这个函数呢？因为在<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->中是没有函数指针的，没有像<!-- raw HTML omitted --><!-- raw HTML omitted -->C++<!-- raw HTML omitted --><!-- raw HTML omitted -->那样的函数指针调用方式来调用函数，所以我们得借助其它方法。经过研究，发现我们可以通过结合使用<!-- raw HTML omitted --><!-- raw HTML omitted -->System.Reflection.Emit<!-- raw HTML omitted --><!-- raw HTML omitted -->及<!-- raw HTML omitted --><!-- raw HTML omitted -->System.Reflection.Assembly<!-- raw HTML omitted --><!-- raw HTML omitted -->里的类和函数达到我们的目的。为了以后使用方便及实现代码的复用，我们可以编写一个类。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->1)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->dld<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->类的编写：<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->1.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->打开项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”，打开类视图，右击“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”，选择“添加”<!-- raw HTML omitted --><!-- raw HTML omitted -->&ndash;&gt;<!-- raw HTML omitted --><!-- raw HTML omitted -->“类”，<!-- raw HTML omitted -->类名设置为“<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->dld<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”，即<!-- raw HTML omitted --><!-- raw HTML omitted -->dynamic loading dll <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->的每个单词的开头字母。<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->2.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->添加所需的命名空间及声明参数传递方式枚举：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>using System.Runtime.InteropServices; // 用 DllImport 需用此 命名空间</p>
<p>using System.Reflection; // 使用 Assembly 类需用此 命名空间</p>
<p>using System.Reflection.Emit; // 使用 ILGenerator 需用此 命名空间</p>
<p> </p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->          <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->public class dld<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”上面添加如下代码声明参数传递方式枚举：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 参数传递方式枚举 ,ByValue 表示值传递 ,ByRef 表示址传递</p>
<p>/// &lt;/summary&gt;</p>
<p>public enum ModePass</p>
<p>{</p>
<p>ByValue = 0x0001,</p>
<p>ByRef = 0x0002</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->3.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->声明<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->LoadLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->、<!-- raw HTML omitted --><!-- raw HTML omitted -->GetProcAddress<!-- raw HTML omitted --><!-- raw HTML omitted -->、<!-- raw HTML omitted --><!-- raw HTML omitted -->FreeLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->及私有变量<!-- raw HTML omitted --><!-- raw HTML omitted -->hModule<!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted -->farProc<!-- raw HTML omitted --><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 原型是 :HMODULE LoadLibrary(LPCTSTR lpFileName);</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;lpFileName&rdquo;&gt;DLL 文件名 &lt;/param&gt;</p>
<p>/// &lt;returns&gt; 函数库模块的句柄 &lt;/returns&gt;</p>
<p>[DllImport(&ldquo;kernel32.dll&rdquo;)]</p>
<p>static extern IntPtr LoadLibrary(string lpFileName);</p>
<p>/// &lt;summary&gt;</p>
<p>/// 原型是 : FARPROC GetProcAddress(HMODULE hModule, LPCWSTR lpProcName);</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;hModule&rdquo;&gt; 包含需调用函数的函数库模块的句柄 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;lpProcName&rdquo;&gt; 调用函数的名称 &lt;/param&gt;</p>
<p>/// &lt;returns&gt; 函数指针 &lt;/returns&gt;</p>
<p>[DllImport(&ldquo;kernel32.dll&rdquo;)]</p>
<p>static extern IntPtr GetProcAddress(IntPtr hModule, string lpProcName);</p>
<p>/// &lt;summary&gt;</p>
<p>/// 原型是 : BOOL FreeLibrary(HMODULE hModule);</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;hModule&rdquo;&gt; 需释放的函数库模块的句柄 &lt;/param&gt;</p>
<p>/// &lt;returns&gt; 是否已释放指定的 Dll&lt;/returns&gt;</p>
<p>[DllImport(&ldquo;kernel32&rdquo;,EntryPoint=&quot;FreeLibrary&rdquo;,SetLastError=true)]</p>
<p>static extern bool FreeLibrary(IntPtr hModule);</p>
<p>/// &lt;summary&gt;</p>
<p>/// Loadlibrary 返回的函数库模块的句柄</p>
<p>/// &lt;/summary&gt;</p>
<p>private IntPtr hModule=IntPtr.Zero;</p>
<p>/// &lt;summary&gt;</p>
<p>/// GetProcAddress 返回的函数指针</p>
<p>/// &lt;/summary&gt;</p>
<p>private IntPtr farProc=IntPtr.Zero;</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->4.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->方法，并为了调用时方便，重载了这个方法：<!-- raw HTML omitted --></p>
<p> </p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 装载 Dll</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;lpFileName&rdquo;&gt;DLL 文件名 &lt;/param&gt;</p>
<p>public void LoadDll(string lpFileName)</p>
<p>{</p>
<p>hModule=LoadLibrary(lpFileName);</p>
<p>if(hModule==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 没有找到 :&ldquo;+lpFileName+&rdquo;.&rdquo; ));</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->          <!-- raw HTML omitted --><!-- raw HTML omitted -->若已有已装载<!-- raw HTML omitted --><!-- raw HTML omitted -->Dll<!-- raw HTML omitted --><!-- raw HTML omitted -->的句柄，可以使用<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->方法的第二个版本：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>public void LoadDll(IntPtr HMODULE)</p>
<p>{</p>
<p>if(HMODULE==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 所传入的函数库模块的句柄 HMODULE 为空 .&rdquo; ));</p>
<p>hModule=HMODULE;</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->5.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadFun<!-- raw HTML omitted --><!-- raw HTML omitted -->方法，并为了调用时方便，也重载了这个方法，方法的具体代码及注释如下：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 获得函数指针</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;lpProcName&rdquo;&gt; 调用函数的名称 &lt;/param&gt;</p>
<p>public void LoadFun(string lpProcName)</p>
<p>{ // 若函数库模块的句柄为空，则抛出异常</p>
<p>if(hModule==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 函数库模块的句柄为空 , 请确保已进行 LoadDll 操作 !&quot;));</p>
<p>// 取得函数指针</p>
<p>farProc = GetProcAddress(hModule,lpProcName);</p>
<p>// 若函数指针，则抛出异常</p>
<p>if(farProc==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 没有找到 :&ldquo;+lpProcName+&rdquo; 这个函数的入口点 &ldquo;));</p>
<p>}</p>
<p>/// &lt;summary&gt;</p>
<p>/// 获得函数指针</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;lpFileName&rdquo;&gt; 包含需调用函数的 DLL 文件名 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;lpProcName&rdquo;&gt; 调用函数的名称 &lt;/param&gt;</p>
<p>public void LoadFun(string lpFileName,string lpProcName)</p>
<p>{ // 取得函数库模块的句柄</p>
<p>hModule=LoadLibrary(lpFileName);</p>
<p>// 若函数库模块的句柄为空，则抛出异常</p>
<p>if(hModule==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 没有找到 :&ldquo;+lpFileName+&rdquo;.&rdquo; ));</p>
<p>// 取得函数指针</p>
<p>farProc = GetProcAddress(hModule,lpProcName);</p>
<p>// 若函数指针，则抛出异常</p>
<p>if(farProc==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 没有找到 :&ldquo;+lpProcName+&rdquo; 这个函数的入口点 &ldquo;));</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->6.<!-- raw HTML omitted -->       <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->UnLoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->及<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法，<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法也进行了重载：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 卸载 Dll</p>
<p>/// &lt;/summary&gt;</p>
<p>public void UnLoadDll()</p>
<p>{</p>
<p>FreeLibrary(hModule);</p>
<p>hModule=IntPtr.Zero;</p>
<p>farProc=IntPtr.Zero;</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->          Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法的第一个版本：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 调用所设定的函数</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;ObjArray_Parameter&rdquo;&gt; 实参 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;TypeArray_ParameterType&rdquo;&gt; 实参类型 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;ModePassArray_Parameter&rdquo;&gt; 实参传送方式 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;Type_Return&rdquo;&gt; 返回类型 &lt;/param&gt;</p>
<p>/// &lt;returns&gt; 返回所调用函数的 object&lt;/returns&gt;</p>
<p>public
object Invoke(object[] ObjArray_Parameter,Type[]
TypeArray_ParameterType,ModePass[] ModePassArray_Parameter,Type
Type_Return)</p>
<p>{</p>
<p>// 下面 3 个 if 是进行安全检查 , 若不能通过 , 则抛出异常</p>
<p>if(hModule==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 函数库模块的句柄为空 , 请确保已进行 LoadDll 操作 !&quot;));</p>
<p>if(farProc==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 函数指针为空 , 请确保已进行 LoadFun 操作 !&rdquo; ) );</p>
<p>if(ObjArray_Parameter.Length!=ModePassArray_Parameter.Length)</p>
<p>throw(new Exception(&rdquo; 参数个数及其传递方式的个数不匹配 .&rdquo; ) );</p>
<p>// 下面是创建 MyAssemblyName 对象并设置其 Name 属性</p>
<p>AssemblyName MyAssemblyName = new AssemblyName();</p>
<p>MyAssemblyName.Name = &ldquo;InvokeFun&rdquo;;</p>
<p>// 生成单模块配件</p>
<p>AssemblyBuilder MyAssemblyBuilder =AppDomain.CurrentDomain.DefineDynamicAssembly(MyAssemblyName,AssemblyBuilderAccess.Run);</p>
<p>ModuleBuilder MyModuleBuilder =MyAssemblyBuilder.DefineDynamicModule(&ldquo;InvokeDll&rdquo;);</p>
<p>// 定义要调用的方法 , 方法名为“ MyFun ”，返回类型是“ Type_Return ”参数类型是“ TypeArray_ParameterType ”</p>
<p>MethodBuilder
MyMethodBuilder
=MyModuleBuilder.DefineGlobalMethod(&ldquo;MyFun&rdquo;,MethodAttributes.Public|
MethodAttributes.Static,Type_Return,TypeArray_ParameterType);</p>
<p>// 获取一个 ILGenerator ，用于发送所需的 IL</p>
<p>ILGenerator IL = MyMethodBuilder.GetILGenerator();</p>
<p>int i;</p>
<p>for (i = 0; i &lt; ObjArray_Parameter.Length; i++)</p>
<p>{// 用循环将参数依次压入堆栈</p>
<p>switch (ModePassArray_Parameter[i])</p>
<p>{</p>
<p>case ModePass.ByValue:</p>
<p>IL.Emit(OpCodes.Ldarg, i);</p>
<p>break;</p>
<p>case ModePass.ByRef:</p>
<p>IL.Emit(OpCodes.Ldarga, i);</p>
<p>break;</p>
<p>default:</p>
<p>throw(new Exception(&rdquo; 第 &quot; +(i+1).ToString() + &quot; 个参数没有给定正确的传递方式 .&rdquo; ) );</p>
<p>}</p>
<p>}</p>
<p>if (IntPtr.Size == 4) {// 判断处理器类型</p>
<p>IL.Emit(OpCodes.Ldc_I4, farProc.ToInt32());</p>
<p>}</p>
<p>else if (IntPtr.Size == 8)</p>
<p>{</p>
<p>IL.Emit(OpCodes.Ldc_I8, farProc.ToInt64());</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>throw new PlatformNotSupportedException();</p>
<p>}</p>
<p>IL.EmitCalli(OpCodes.Calli,CallingConvention.StdCall,Type_Return,TypeArray_ParameterType);</p>
<p>IL.Emit(OpCodes.Ret); // 返回值</p>
<p>MyModuleBuilder.CreateGlobalFunctions();</p>
<p>// 取得方法信息</p>
<p>MethodInfo MyMethodInfo = MyModuleBuilder.GetMethod(&ldquo;MyFun&rdquo;);</p>
<p>return MyMethodInfo.Invoke(null, ObjArray_Parameter);// 调用方法，并返回其值</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->         Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法的第二个版本，它是调用了第一个版本的：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 调用所设定的函数</p>
<p>/// &lt;/summary&gt;</p>
<p>/// &lt;param name=&quot;IntPtr_Function&rdquo;&gt; 函数指针 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;ObjArray_Parameter&rdquo;&gt; 实参 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;TypeArray_ParameterType&rdquo;&gt; 实参类型 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;ModePassArray_Parameter&rdquo;&gt; 实参传送方式 &lt;/param&gt;</p>
<p>/// &lt;param name=&quot;Type_Return&rdquo;&gt; 返回类型 &lt;/param&gt;</p>
<p>/// &lt;returns&gt; 返回所调用函数的 object&lt;/returns&gt;</p>
<p>public
object Invoke(IntPtr IntPtr_Function,object[] ObjArray_Parameter,Type[]
TypeArray_ParameterType,ModePass[] ModePassArray_Parameter,Type
Type_Return)</p>
<p>{</p>
<p>// 下面 2 个 if 是进行安全检查 , 若不能通过 , 则抛出异常</p>
<p>if(hModule==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 函数库模块的句柄为空 , 请确保已进行 LoadDll 操作 !&quot;));</p>
<p>if(IntPtr_Function==IntPtr.Zero)</p>
<p>throw(new Exception(&rdquo; 函数指针 IntPtr_Function 为空 !&rdquo; ) );</p>
<p>farProc=IntPtr_Function;</p>
<p>return Invoke(ObjArray_Parameter,TypeArray_ParameterType,ModePassArray_Parameter,Type_Return);</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->2)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->dld<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->类的使用：<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->1． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->打开项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”，向“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->窗体中添加<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->三个按钮。<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Name <!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted -->Text<!-- raw HTML omitted --><!-- raw HTML omitted -->属性分别为<!-- raw HTML omitted --> <!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->B3<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->、“用<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadLibrary<!-- raw HTML omitted --><!-- raw HTML omitted -->方法装载<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->”，“<!-- raw HTML omitted --><!-- raw HTML omitted -->B4<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->、“调用<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->方法”，“<!-- raw HTML omitted --><!-- raw HTML omitted -->B5<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->、“卸载<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->”，<!-- raw HTML omitted -->并调整到适当的大小及位置<!-- raw HTML omitted -->。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->2． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B3<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B3_Click<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体上面添加代码，创建一个<!-- raw HTML omitted --><!-- raw HTML omitted -->dld<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->类实例：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>/// &lt;summary&gt;</p>
<p>/// 创建一个 dld 类对象</p>
<p>/// &lt;/summary&gt;</p>
<p>private dld myfun=new dld();</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->  <!-- raw HTML omitted -->3． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B3_Click<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>myfun.LoadDll(&ldquo;Count.dll&rdquo;); // 加载 &ldquo;Count.dll&rdquo;</p>
<p>myfun.LoadFun(&quot;_count@4&rdquo;); // 调入函数 count, &ldquo;_count@4&rdquo; 是它的入口，可通过 Depends 查看</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->4． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B4<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B4_Click<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Type[] ParameterTypes = new Type[]{typeof(int)}; // 实参类型为 int</p>
<p>ModePass[] themode=new ModePass[]{ModePass.ByValue}; // 传送方式为值传</p>
<p>Type Type_Return = typeof(int); // 返回类型为 int</p>
<p>// 弹出提示框，显示调用 myfun.Invoke 方法的结果，即调用 count 函数</p>
<p>MessageBox.Show(&rdquo; 这是您装载该 Dll 后第 &ldquo;+myfun.Invoke(Parameters,ParameterTypes,themode,Type_Return).ToString()</p>
<p>+&rdquo; 次点击此按钮。 &ldquo;,&rdquo; 挑战杯 &ldquo;);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->5． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B5<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B5_Click<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>myfun.UnLoadDll();</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->6． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->按“<!-- raw HTML omitted --><!-- raw HTML omitted -->F5<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”运行该程序，并先点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B3<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->以<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->加载“<!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->，接着点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B4<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->三次以调用<!-- raw HTML omitted --><!-- raw HTML omitted -->3<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->次“<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->count(0)<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted -->，<!-- raw HTML omitted -->先后弹出的提示框如下<!-- raw HTML omitted -->：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->          <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->这三个提示框所得出的结果说明了静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->S <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->经初始化后，再传入实参“<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted -->也不会改变其值为“<!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted -->。<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->7． <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B5<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->以卸载“<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”，再点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B3<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->进行装载“<!-- raw HTML omitted --><!-- raw HTML omitted -->Count.dll<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”，再点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B4<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->查看调用了“<!-- raw HTML omitted --><!-- raw HTML omitted -->count(0)<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->”的结果：<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->从弹出的提示框所显示的结果可以看到又开始重新计数了，也就是实现了<!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->的动态装载与卸载了。<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->(三)<!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->调用托管<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->一般方法<!-- raw HTML omitted --></strong><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->C# <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->调用托管<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->是很简单的，只要在“解决方案资源管理器”中的需要调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->的项目下用鼠标右击“引用”，并选择“添加引用”，然后选择已列出的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->或通过浏览来选择<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->文件，最后需要用<!-- raw HTML omitted --><!-- raw HTML omitted -->using <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->导入相关的命名空间。<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->(四)<!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->动态调用托管<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->C# <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->动态调用托管<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->也需要借助<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->System.Reflection.Assembly<!-- raw HTML omitted --><!-- raw HTML omitted -->里的类和方法，主要使用了<!-- raw HTML omitted --><!-- raw HTML omitted -->Assembly.LoadFrom<!-- raw HTML omitted --><!-- raw HTML omitted -->。现在，用例子说明：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted -->首先，启动<!-- raw HTML omitted --><!-- raw HTML omitted -->VS.NET<!-- raw HTML omitted --><!-- raw HTML omitted -->，新建一个<!-- raw HTML omitted --><!-- raw HTML omitted -->Visual C# <!-- raw HTML omitted --><!-- raw HTML omitted -->项目，使用的模板为“类库”，名称为“<!-- raw HTML omitted --><!-- raw HTML omitted -->CsCount<!-- raw HTML omitted --><!-- raw HTML omitted -->”，并在类“<!-- raw HTML omitted --><!-- raw HTML omitted -->Class1<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->中<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->添加静态整型变量<!-- raw HTML omitted --><!-- raw HTML omitted -->S<!-- raw HTML omitted --><!-- raw HTML omitted -->及方法<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 由于 static 不能修饰方法体内的变量，所以需放在这里，且初始化值为 int.MinValue</p>
<p>static int S=int.MinValue;</p>
<p>public int count(int init)</p>
<p>{// 判断 S 是否等于 int.MinValue ，是的话把 init 赋值给 S</p>
<p>if(S==int.MinValue) S=init;</p>
<p>S++; //S 自增 1</p>
<p>return S; // 返回 S</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->然后，打开项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”，向“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->窗体中添加<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->一个按钮，<!-- raw HTML omitted --><!-- raw HTML omitted -->Name<!-- raw HTML omitted --><!-- raw HTML omitted -->属性为“<!-- raw HTML omitted --><!-- raw HTML omitted -->B6<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->，<!-- raw HTML omitted -->Text<!-- raw HTML omitted --><!-- raw HTML omitted -->属性为“用<!-- raw HTML omitted --><!-- raw HTML omitted -->Assembly<!-- raw HTML omitted --><!-- raw HTML omitted -->类来动态调用托管<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->”，调整到适当大小和位置，双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B6<!-- raw HTML omitted --><!-- raw HTML omitted -->，转入代码视图，先导入命名空间：<!-- raw HTML omitted --><!-- raw HTML omitted -->using System.Reflection; <!-- raw HTML omitted --><!-- raw HTML omitted -->接着添加<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法和<!-- raw HTML omitted --><!-- raw HTML omitted -->B6_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->方法代码：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>private object Invoke(string lpFileName,string Namespace,string ClassName,string lpProcName,object[] ObjArray_Parameter)</p>
<p>{</p>
<p>Try { // 载入程序集</p>
<p>Assembly MyAssembly=Assembly.LoadFrom(lpFileName);</p>
<p>Type[] type=MyAssembly.GetTypes();</p>
<p>foreach(Type t in type)</p>
<p>{// 查找要调用的命名空间及类</p>
<p>if(t.Namespace==Namespace&amp;&amp;t.Name==ClassName)</p>
<p>{// 查找要调用的方法并进行调用</p>
<p>MethodInfo m=t.GetMethod(lpProcName);</p>
<p>if(m!=null)</p>
<p>{</p>
<p>object o=Activator.CreateInstance(t);</p>
<p>return m.Invoke(o,ObjArray_Parameter);</p>
<p>}</p>
<p>else MessageBox.Show(&rdquo; 装载出错 !&quot;);</p>
<p>}</p>
<p>}</p>
<p>}//try</p>
<p>catch(System.NullReferenceException e)</p>
<p>{</p>
<p>MessageBox.Show(e.Message);</p>
<p>}//catch</p>
<p>return (object)0;</p>
<p>}// Invoke</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->B6_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内代码如下：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 显示 count(0) 返回的值</p>
<p>MessageBox.Show(&rdquo; 这是您第 &ldquo;+Invoke(&ldquo;CsCount.dll&rdquo;,&ldquo;CsCount&rdquo;,&ldquo;Class1&rdquo;,&ldquo;count&rdquo;,new object[]{(int)0}).ToString()+&rdquo; 次点击此按钮。 &ldquo;,&rdquo; 挑战杯 &ldquo;);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p><!-- raw HTML omitted -->最后，把项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->CsCount<!-- raw HTML omitted --><!-- raw HTML omitted -->”的<!-- raw HTML omitted --><!-- raw HTML omitted -->bin\Debug<!-- raw HTML omitted --><!-- raw HTML omitted -->文件夹中的<!-- raw HTML omitted --><!-- raw HTML omitted -->CsCount.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->复制到项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”的<!-- raw HTML omitted --><!-- raw HTML omitted -->bin\Debug<!-- raw HTML omitted --><!-- raw HTML omitted -->文件夹中，按“<!-- raw HTML omitted --><!-- raw HTML omitted -->F5<!-- raw HTML omitted --><!-- raw HTML omitted -->”<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->运行该程序，并点击按钮<!-- raw HTML omitted -->B6<!-- raw HTML omitted --><!-- raw HTML omitted -->三次，将会弹出<!-- raw HTML omitted --><!-- raw HTML omitted -->3<!-- raw HTML omitted --><!-- raw HTML omitted -->个提示框，内容分别是“这是您第<!-- raw HTML omitted --><!-- raw HTML omitted --> 1<!-- raw HTML omitted --><!-- raw HTML omitted -->次点击此按钮。”、“这是您第<!-- raw HTML omitted --><!-- raw HTML omitted --> 2<!-- raw HTML omitted --><!-- raw HTML omitted -->次点击此按钮。”、“这是您第<!-- raw HTML omitted --><!-- raw HTML omitted --> 3<!-- raw HTML omitted --><!-- raw HTML omitted -->次点击此按钮。”，由此知道了静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->S<!-- raw HTML omitted --><!-- raw HTML omitted -->在这里的作用。<!-- raw HTML omitted --></p>
<p> </p>
<p><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->(<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->五<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->) C#<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->程序<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->嵌入<!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->的调用<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->     <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件作为资源嵌入在<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->程序<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->中，我们只要读取该资源文件并以“<!-- raw HTML omitted --><!-- raw HTML omitted -->byte[]<!-- raw HTML omitted --><!-- raw HTML omitted -->”返回，然后就用“<!-- raw HTML omitted -->Assembly Load(byte[]);<!-- raw HTML omitted -->”得到<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的<!-- raw HTML omitted --><!-- raw HTML omitted -->程序集，最后就可以像上面的<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法那样对<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的方法进行调用。当然不用上面方法也可以，如用接口实现动态调用，但<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中必须有该接口的定义并且<!-- raw HTML omitted -->程序<!-- raw HTML omitted -->中也要有该接口的定义；也可用反射发送实现动态调用<!-- raw HTML omitted --><!-- raw HTML omitted -->[4]<!-- raw HTML omitted --><!-- raw HTML omitted -->。现在我只对<!-- raw HTML omitted --><!-- raw HTML omitted -->像上面的<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法那样对<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中的方法进行调用进行讨论，为了以后使用方便及实现代码的复用，我们可以结合上一个编写一个类。<!-- raw HTML omitted --></p>
<p><strong><!-- raw HTML omitted -->1)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->ldfs<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->类的编写：<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->在项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”中新建一个名为<!-- raw HTML omitted --><!-- raw HTML omitted -->ldfs<!-- raw HTML omitted --><!-- raw HTML omitted -->的类，意为“<!-- raw HTML omitted --><!-- raw HTML omitted -->load dll from resource<!-- raw HTML omitted --><!-- raw HTML omitted -->”，请注意，在这个类中“<!-- raw HTML omitted --><!-- raw HTML omitted -->resource<!-- raw HTML omitted --><!-- raw HTML omitted -->”不只是嵌入在<!-- raw HTML omitted --><!-- raw HTML omitted -->EXE<!-- raw HTML omitted --><!-- raw HTML omitted -->程序中的资源，它也可以是硬盘上任意一个<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件，这是因为<!-- raw HTML omitted --><!-- raw HTML omitted -->ldfs<!-- raw HTML omitted --><!-- raw HTML omitted -->的类中的方法<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->有些特别，就是先从程序的内嵌的资源中查找需加载的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，如果找不到，就查找硬盘上的。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->首先导入所需的命名空间：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>using System.IO; // 对文件的读写需要用到此命名空间</p>
<p>using System.Reflection; // 使用 Assembly 类需用此命名空间</p>
<p>using System.Reflection.Emit; // 使用 ILGenerator 需用此命名空间</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->声明一静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->MyAssembly<!-- raw HTML omitted --><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 记录要导入的程序集</p>
<p>static Assembly MyAssembly;</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->LoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->方法：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>private byte[] LoadDll(string lpFileName)</p>
<p>{</p>
<p>Assembly NowAssembly = Assembly.GetEntryAssembly();</p>
<p>Stream fs=null;</p>
<p>try</p>
<p>{// 尝试读取资源中的 DLL</p>
<p>fs = NowAssembly.GetManifestResourceStream(NowAssembly.GetName().Name+&rdquo;.&ldquo;+lpFileName);</p>
<p>}</p>
<p>finally</p>
<p>{// 如果资源没有所需的 DLL ，就查看硬盘上有没有，有的话就读取</p>
<p>if (fs==null&amp;&amp;!File.Exists(lpFileName)) throw(new Exception(&rdquo; 找不到文件 :&ldquo;+lpFileName));</p>
<p>else if(fs==null&amp;&amp;File.Exists(lpFileName))</p>
<p>{</p>
<p>FileStream Fs = new FileStream(lpFileName, FileMode.Open);</p>
<p>fs=(Stream)Fs;</p>
<p>}</p>
<p>}</p>
<p>byte[] buffer = new byte[(int) fs.Length];</p>
<p>fs.Read(buffer, 0, buffer.Length);</p>
<p>fs.Close();</p>
<p>return buffer; // 以 byte[] 返回读到的 DLL</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->UnLoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->方法来卸载<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>public void UnLoadDll()</p>
<p>{// 使 MyAssembly 指空</p>
<p>MyAssembly=null;</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->方法来进行对<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->中方法的调用，其原理大体上和“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->”中的方法<!-- raw HTML omitted --><!-- raw HTML omitted -->Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->相同，不过这里用的是<!-- raw HTML omitted --><!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->Assembly.Load<!-- raw HTML omitted --><!-- raw HTML omitted -->”，而且用了<!-- raw HTML omitted --><!-- raw HTML omitted -->静态变量<!-- raw HTML omitted --><!-- raw HTML omitted -->MyAssembly<!-- raw HTML omitted --><!-- raw HTML omitted -->来保存已加载的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->，如果已加载的话就不再加载，如果还没加载或者已加载的不同现在要加载的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->就进行加载，其代码如下所示：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>public object Invoke(string lpFileName,string Namespace,string ClassName,string lpProcName,object[] ObjArray_Parameter)</p>
<p>{</p>
<p>try</p>
<p>{// 判断 MyAssembly 是否为空或 MyAssembly 的命名空间不等于要调用方法的命名空间，如果条件为真，就用 Assembly.Load 加载所需 DLL 作为程序集</p>
<p>if(MyAssembly==null||MyAssembly.GetName().Name!=Namespace)</p>
<p>MyAssembly=Assembly.Load(LoadDll(lpFileName));</p>
<p>Type[] type=MyAssembly.GetTypes();</p>
<p>foreach(Type t in type)</p>
<p>{</p>
<p>if(t.Namespace==Namespace&amp;&amp;t.Name==ClassName)</p>
<p>{</p>
<p>MethodInfo m=t.GetMethod(lpProcName);</p>
<p>if(m!=null)</p>
<p>{// 调用并返回</p>
<p>object o=Activator.CreateInstance(t);</p>
<p>return m.Invoke(o,ObjArray_Parameter);</p>
<p>}</p>
<p>else</p>
<p>System.Windows.Forms.MessageBox.Show(&rdquo; 装载出错 !&quot;);</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>catch(System.NullReferenceException e)</p>
<p>{</p>
<p>System.Windows.Forms.MessageBox.Show(e.Message);</p>
<p>}</p>
<p>return (object)0;</p>
<p>}</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p> </p>
<p> </p>
<p><strong><!-- raw HTML omitted -->2)<!-- raw HTML omitted -->        <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->ldfs<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted -->类的使用：<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->1． <!-- raw HTML omitted --><!-- raw HTML omitted -->把<!-- raw HTML omitted --><!-- raw HTML omitted -->CsCount.dll<!-- raw HTML omitted --><!-- raw HTML omitted -->作为“嵌入的资源”添加到项目“<!-- raw HTML omitted --><!-- raw HTML omitted -->Tzb<!-- raw HTML omitted --><!-- raw HTML omitted -->”中。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->2． <!-- raw HTML omitted --><!-- raw HTML omitted -->向“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->”窗体中添加两个按钮，<!-- raw HTML omitted --><!-- raw HTML omitted -->Name<!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted -->Text<!-- raw HTML omitted --><!-- raw HTML omitted -->属性分别为“<!-- raw HTML omitted --><!-- raw HTML omitted -->B7<!-- raw HTML omitted --><!-- raw HTML omitted -->”、“<!-- raw HTML omitted --><!-- raw HTML omitted -->ldfs.Invoke<!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->count<!-- raw HTML omitted --><!-- raw HTML omitted -->”；“<!-- raw HTML omitted --><!-- raw HTML omitted -->B8<!-- raw HTML omitted --><!-- raw HTML omitted -->”、“<!-- raw HTML omitted --><!-- raw HTML omitted -->UnLoadDll<!-- raw HTML omitted --><!-- raw HTML omitted -->”，并将它们调整到适当大小和位置。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->3． <!-- raw HTML omitted --><!-- raw HTML omitted -->打开“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->”代码视图，添加一个<!-- raw HTML omitted --><!-- raw HTML omitted -->ldfs<!-- raw HTML omitted --><!-- raw HTML omitted -->实例：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 添加一个 ldfs 实例 tmp</p>
<p>private ldfs tmp=new ldfs();</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->4． <!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B7<!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B1_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 调用 count(0), 并使用期提示框显示其返回值</p>
<p>MessageBox.Show(&rdquo;
这是您第 &ldquo;+tmp.Invoke(&ldquo;CsCount.dll&rdquo;,&ldquo;CsCount&rdquo;,&ldquo;Class1&rdquo;,&ldquo;count&rdquo;,new
object[]{(int)0}).ToString()+&rdquo; 次点击此按钮。 &ldquo;,&rdquo; 挑战杯 &ldquo;);</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->5． <!-- raw HTML omitted --><!-- raw HTML omitted -->在“<!-- raw HTML omitted --><!-- raw HTML omitted -->Form1<!-- raw HTML omitted --><!-- raw HTML omitted -->．<!-- raw HTML omitted --><!-- raw HTML omitted -->cs<!-- raw HTML omitted --><!-- raw HTML omitted -->［设计］”视图中双击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B7<!-- raw HTML omitted --><!-- raw HTML omitted -->，在“<!-- raw HTML omitted --><!-- raw HTML omitted -->B1_Click<!-- raw HTML omitted --><!-- raw HTML omitted -->”方法体内添加如下代码：<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>// 卸载 DLL</p>
<p>tmp.UnLoadDll();</p>
<pre><code>        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/tbody&gt;
</code></pre>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->6． <!-- raw HTML omitted --><!-- raw HTML omitted -->“<!-- raw HTML omitted --><!-- raw HTML omitted -->F5<!-- raw HTML omitted --><!-- raw HTML omitted -->”运行该程序，并先点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B7<!-- raw HTML omitted --><!-- raw HTML omitted -->三次，接着点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B8<!-- raw HTML omitted --><!-- raw HTML omitted -->，最后再点击按钮<!-- raw HTML omitted --><!-- raw HTML omitted -->B7<!-- raw HTML omitted --><!-- raw HTML omitted -->，此时发现又开始重新计数了，情况和“<!-- raw HTML omitted --><!-- raw HTML omitted -->dld<!-- raw HTML omitted --><!-- raw HTML omitted -->类的使用”类似，<!-- raw HTML omitted --><!-- raw HTML omitted -->也就是也实现了<!-- raw HTML omitted -->DLL<!-- raw HTML omitted -->的动态装载与卸载了<!-- raw HTML omitted --><!-- raw HTML omitted -->。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->    <!-- raw HTML omitted --><!-- raw HTML omitted -->说明：以上所用到的所有源代码详见附件<!-- raw HTML omitted --><!-- raw HTML omitted -->1:Form1.cs<!-- raw HTML omitted --><!-- raw HTML omitted -->、附件<!-- raw HTML omitted --><!-- raw HTML omitted -->2:dld.cs<!-- raw HTML omitted --><!-- raw HTML omitted -->、附件<!-- raw HTML omitted --><!-- raw HTML omitted -->3:ldfs.cs<!-- raw HTML omitted --><!-- raw HTML omitted -->、附件<!-- raw HTML omitted --><!-- raw HTML omitted -->4:Count.cpp<!-- raw HTML omitted --><!-- raw HTML omitted -->、附件<!-- raw HTML omitted --><!-- raw HTML omitted -->5:Class1.cs<!-- raw HTML omitted --><!-- raw HTML omitted -->。<!-- raw HTML omitted --></p>
<p> </p>
<p><strong><!-- raw HTML omitted -->三、<!-- raw HTML omitted -->      <!-- raw HTML omitted --><!-- raw HTML omitted --><strong><strong><!-- raw HTML omitted -->结<!-- raw HTML omitted --></strong></strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->****<!-- raw HTML omitted -->论<!-- raw HTML omitted --></strong></p>
<p><!-- raw HTML omitted -->使用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->有很多优点，如：节省内存和减少交换操作；开发大型程序时可以把某些模块分配给程序员，程序员可以用任何一门他所熟悉的语言把该模块编译成<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件，这样可以提高代码的复用，大大减轻程序员的工作量。当然<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->也有一些不足，如在提要中提及的问题。所以，如何灵活地调用<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->应该是每位程序员所熟知的。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->C# <!-- raw HTML omitted --><!-- raw HTML omitted -->语言有很多优点，越来越多的人开始使用它来编程。但是，<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->还有一些不足，如对不少的底层操作是无能为力的，只能通过调用<!-- raw HTML omitted --><!-- raw HTML omitted -->Win32 DLL <!-- raw HTML omitted --><!-- raw HTML omitted -->或<!-- raw HTML omitted --><!-- raw HTML omitted -->C++<!-- raw HTML omitted --><!-- raw HTML omitted -->等编写的<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->；另外，一般认为<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->程序的保密性不够强，因为它容易被<!-- raw HTML omitted --><!-- raw HTML omitted -->Reflector <!-- raw HTML omitted --><!-- raw HTML omitted -->反编译而得到部分源码，所以需要使用混合编程加强<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->程序的保密性，而把<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->嵌入<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->程序并实现动态调用的方法是比较理想的方法，因为可以把<!-- raw HTML omitted --><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->文件先用某一算法进行加密甚至压缩后再作为资源文件添加到<!-- raw HTML omitted --><!-- raw HTML omitted -->C#<!-- raw HTML omitted --><!-- raw HTML omitted -->程序中，在程序运行时才用某一算法进行解压解密后才进行加载，所以即使用反编译软件，也只能得到一个资源文件，且这个资源文件是用一个复杂算法进行加密过的，不可能再次对资源文件中的内容进行反编译，从而大大加强了代码的保密性。<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->参考文献：<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[1]  <!-- raw HTML omitted --><!-- raw HTML omitted -->引自：<!-- raw HTML omitted --><!-- raw HTML omitted -->《什么是<!-- raw HTML omitted --><!-- raw HTML omitted --> DLL?<!-- raw HTML omitted --><!-- raw HTML omitted -->》，网址：<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><a href="http://support.microsoft.com/default.aspx?scid=kb;zh-cn;815065">http://support.microsoft.com/default.aspx?scid=kb;zh-cn;815065</a><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[2] <!-- raw HTML omitted --><!-- raw HTML omitted -->《在<!-- raw HTML omitted --><!-- raw HTML omitted --> C# <!-- raw HTML omitted --><!-- raw HTML omitted -->中通过<!-- raw HTML omitted --><!-- raw HTML omitted --> P/Invoke <!-- raw HTML omitted --><!-- raw HTML omitted -->调用<!-- raw HTML omitted --><!-- raw HTML omitted -->Win32 DLL<!-- raw HTML omitted --><!-- raw HTML omitted -->》<!-- raw HTML omitted --> <!-- raw HTML omitted -->Jason Clark <!-- raw HTML omitted --><!-- raw HTML omitted -->，<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->网址：<!-- raw HTML omitted --><!-- raw HTML omitted --><a href="http://www.microsoft.com/china/msdn/library/langtool/vcsharp/ousNET.mspx">http://www.microsoft.com/china/msdn/library/langtool/vcsharp/ousNET.mspx</a><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[3] <!-- raw HTML omitted --><!-- raw HTML omitted -->《深入分析<!-- raw HTML omitted --><!-- raw HTML omitted -->Windows<!-- raw HTML omitted --><!-- raw HTML omitted -->和<!-- raw HTML omitted --><!-- raw HTML omitted -->Linux<!-- raw HTML omitted --><!-- raw HTML omitted -->动态库应用异同》刘世栋<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->杨林，<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->网址：<!-- raw HTML omitted --><!-- raw HTML omitted --><a href="http://tech.ccidnet.com/art/302/20050919/336005_1.html">http://tech.ccidnet.com/art/302/20050919/336005_1.html</a><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->[4] <!-- raw HTML omitted --><!-- raw HTML omitted -->《<!-- raw HTML omitted --><!-- raw HTML omitted -->C# <!-- raw HTML omitted --><!-- raw HTML omitted -->程序设计》<!-- raw HTML omitted --><!-- raw HTML omitted --> Jesse Liberty <!-- raw HTML omitted --><!-- raw HTML omitted -->著<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->刘基诚<!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted -->译<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --><!-- raw HTML omitted -->中国电力出版社<!-- raw HTML omitted --></p>
<p>Trackback: <a href="http://tb.blog.csdn.net/TrackBack.aspx?PostId=568096">http://tb.blog.csdn.net/TrackBack.aspx?PostId=568096</a></p>
<!-- raw HTML omitted -->
<p><strong>[温馨提示]：该文章由原博客园导入而来，如排版效果不佳，请移步：<a href="http://www.cnblogs.com/coderzh/archive/2007/12/27/1016924.html">http://www.cnblogs.com/coderzh/archive/2007/12/27/1016924.html</a></strong></p>

                      
                    </div>
                    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
                        <div style="float:left;margin-top:0px;">
                        <img src="https://blog.coderzh.com/public/qrcode.jpg" width="129px" height="129px"/>
                        <div style="text-align:center;">微信扫一扫交流</div>
                        </div>
                        <div>
                            <p style="margin-top:0px;">作者：<a target="_blank" href="http://blog.coderzh.com/">CoderZh</a>
                            <br />微信关注：hacker-thinking （代码随想）
                            <br />本文出处：<a target="_blank" href="https://blog.coderzh.com/2007/12/27/1016924/">https://blog.coderzh.com/2007/12/27/1016924/</a>
                            <br />
                            文章版权归本人所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。 </p>
                        </div>
                    </div>
                    <div class="clear"></div>
                  </div>
                  

                </div>
                
              </article>
              
              <div class="clear"></div>
              
              
              
            </div>
          </section>
          <div class="sidebar s1">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>
  <div class="sidebar-content">
    <div class="sidebar-top group">
      <p>Follow:</p>
      <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On WeiBo"
        href="http://weibo.com/coderzh" target="_blank">
        <i class="fa fa-weibo"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On Twitter" rel="nofollow"
        href="https://twitter.com/coderzh" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub"
        href="https://github.com/coderzh" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

    </div>
    <div class="widget qrcode">
    <img src="https://blog.coderzh.com/public/qrcode.jpg" alt="qrcode" width="172px" height="172px"/>
    <p> 微信扫一扫：<br/> 关注我的公众号： <br /> hacker-thinking <br /></p>
</div>

    <ul class="post-nav group">
      <li class="next">
        
        <a href="https://blog.coderzh.com/2008/01/01/1022532/" rel="next">
          <i class="fa fa-chevron-right"></i>
          <strong>Next post</strong>
          <span>希望2008</span>
        </a>
        
      </li>
      <li class="previous">
        
        <a href="https://blog.coderzh.com/2007/12/10/989375/" rel="prev">
          <i class="fa fa-chevron-left"></i>
          <strong>Previous Post</strong>
          <span>保证程序只有一个实例运行并且先将旧实例关闭再运行新实例</span>
        </a>
        
      </li>
    </ul>
    <div id="search-2" class="widget widget_search"><h3>Search</h3>
      <form method="get" class="searchform themeform" action="https://www.google.com/search">
        <div>
          <input type="text" class="search" name="q" placeholder="Press enter to start searching">
        </div>
      </form>
    </div>
  </div>
  
</div>

          <div class="sidebar s2">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>
  <div class="sidebar-content">
    <div class="sidebar-top group">
      <p>More</p>
    </div>
    <div id="categories-2" class="widget widget_categories"><h3>Categories</h3>
      <ul>
        
          <li class="cat-item cat-item-1">
            <a rel="nofollow" href="https://blog.coderzh.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
          </li>
        
          <li class="cat-item cat-item-1">
            <a rel="nofollow" href="https://blog.coderzh.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a>
          </li>
        
          <li class="cat-item cat-item-1">
            <a rel="nofollow" href="https://blog.coderzh.com/categories/%E6%80%9D%E8%80%83%E6%84%9F%E6%82%9F/">思考感悟</a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
  <footer id="footer">
  <section class="container" id="footer-bottom">
    <div class="container-inner">
      <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
      <div class="pad group">
        <div class="grid one-half">
          <div id="copyright">
              <p>Copyright (c) 2017. All rights reserved.<br>Powered by
              <a rel="nofollow" href="http://gohugo.io/" target="_blank">Hugo - the static site generator</a>.
              <a rel="nofollow" href="http://golang.org" target="_blank">#golang</a>.
            </p>
          </div>
          
        </div>
        
        <div class="grid one-half last">
          <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On WeiBo"
        href="http://weibo.com/coderzh" target="_blank">
        <i class="fa fa-weibo"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On Twitter" rel="nofollow"
        href="https://twitter.com/coderzh" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub"
        href="https://github.com/coderzh" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

        </div>
      </div>

    </div>
    
  </section>
  
</footer>

</div>

</body>
</html>

